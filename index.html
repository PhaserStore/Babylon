<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Babylon – Gallery Logos (sharp + glow)</title>
  <style>
    html, body { width:100%; height:100%; margin:0; padding:0; background:#000; }
    #renderCanvas { width:100%; height:100%; touch-action:none; display:block; }
  </style>
  <!-- Babylon.js (CDN) -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
  <canvas id="renderCanvas"></canvas>

  <script>
  // -----------------------------
  //  Pomocné globální konstanty
  // -----------------------------
  window.hint        = window.hint        || console.log;
  window.ROOM        = window.ROOM        || { W: 18, D: 20, H: 6 };
  window.WALL_LAYOUT = window.WALL_LAYOUT || { centerY: 1.30 };
  window.FRAME_SIZE  = window.FRAME_SIZE  || { H: 1.00 };

  const GLOW_BLUR_PX      = 18;    // jemné rozmazání glow textury
  const FRONT_BACK_OFFSET = 0.25;  // odsazení log od stěn (m)

  // ------------------------------------------------
  //  LOGO 1 – tvoje (beze změn, jen inline jako SVG)
  // ------------------------------------------------
  const GALLERY_LOGO_SVG = `
<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 941.43 272.86" preserveAspectRatio="xMidYMid meet">
  <defs><style>.cls-1{fill:#daff3e;}</style></defs>
  <g>
    <path class="cls-1" d="M317.06,103.94h-76.71c-2.05,0-3.72-1.66-3.72-3.72s1.66-3.72,3.72-3.72h76.71c2.05,0,3.72,1.66,3.72,3.72s-1.66,3.72-3.72,3.72Z"/>
    <path class="cls-1" d="M299.75,179.35c-.28,0-.55-.03-.83-.1-2-.46-3.25-2.45-2.79-4.45l17.31-75.4c.46-2,2.46-3.25,4.45-2.79,2,.46,3.25,2.45,2.79,4.45l-17.31,75.4c-.39,1.72-1.93,2.89-3.62,2.89Z"/>
    <path class="cls-1" d="M222.8,180.12c-.28,0-.56-.03-.84-.1-2-.46-3.25-2.45-2.79-4.45l27.14-117.91c.46-2,2.45-3.25,4.46-2.79 2,.46 3.25,2.46 2.79,4.46l-27.14,117.91c-.4,1.72-1.93,2.88-3.62,2.88Z"/>
    <path class="cls-1" d="M439.3,179.34h-139.39c-2.05,0-3.72-1.66-3.72-3.72s1.66-3.72,3.72-3.72h136.43l15.6-67.97h-70.53c-2.05,0-3.72-1.66-3.72-3.72s1.66-3.72,3.72-3.72h75.2c1.13,0,2.2.52,2.91,1.4.71.89.97,2.04.72,3.15l-17.31,75.4c-.39,1.69-1.89,2.88-3.62,2.88Z"/>
    <path class="cls-1" d="M785.01,179.34c-.28,0-.55-.03-.83-.1-2-.46-3.25-2.45-2.79-4.45l17.31-75.4c.39-1.69,1.89-2.88,3.62-2.88h76.96c2.05,0,3.72,1.66,3.72,3.72s-1.66,3.72-3.72,3.72h-74l-16.65,72.52c-.39,1.72-1.93,2.89-3.62,2.89Z"/>
    <path class="cls-1" d="M211.85,180.13l-170.7-.27c-2.05,0-3.71-1.67-3.71-3.72,0-2.05,1.67-3.71,3.72-3.71l170.7.27c2.05,0,3.71,1.67,3.71,3.72,0,2.05-1.67,3.71-3.72,3.71Z"/>
    <path class="cls-1" d="M72.27,221.31c-.28,0-.55-.03-.83-.1-2-.46-3.25-2.45-2.79-4.45l26.94-117.36c.46-2,2.46-3.25,4.45-2.79,2,.46,3.25,2.45,2.79,4.45l-26.94,117.36c-.39,1.72-1.93,2.89-3.62,2.89Z"/>
    <path class="cls-1" d="M784.97,179.34h-141.2c-1.13,0-2.2-.52-2.91-1.4-.71-.89-.97-2.04-.72-3.15l17.31-75.4c.39-1.69,1.89-2.88,3.62-2.88h76.41c2.05,0,3.72,1.66,3.72,3.72s-1.66,3.72-3.72,3.72h-73.45l-15.6,67.97h136.53c2.05,0,3.72,1.66,3.72,3.72s-1.66,3.72-3.72,3.72Z"/>
    <path class="cls-1" d="M158.76,180.12c-.28,0-.55-.03-.83-.1-2-.46-3.25-2.45-2.79-4.45l16.44-71.63h-72.37c-2.05,0-3.72-1.66-3.72-3.72s1.66-3.72,3.72-3.72h77.03c1.13,0,2.2.52,2.91,1.4.71.89.97,2.04.71,3.15l-17.49,76.18c-.39,1.72-1.93,2.89-3.62,2.89Z"/>
    <path class="cls-1" d="M222.74,180.13l-182.02-.27c-2.05,0-3.71-1.67-3.71-3.72,0-2.05,1.67-3.71,3.72-3.71l182.02.27c2.05,0,3.71,1.67,3.71,3.72,0,2.05-1.67,3.71-3.72,3.71Z"/>
    <path class="cls-1" d="M602.74,212.29c-.55,0-1.09-.12-1.61-.37-.76-.36-1.35-.96-1.71-1.68l-103.95-136.78-129.09,105.46c-1.59,1.3-3.93,1.06-5.23-.53-1.3-1.59-1.06-3.93.53-5.23l131.89-107.74c.39-.36.86-.64,1.38-.81,1.5-.48,3.14.02,4.1,1.28l104.39,137.36 131.99-105.98c1.6-1.29,3.94-1.03,5.22.57 1.28,1.6 1.03,3.94-.57,5.22l-135.02,108.4c-.67.54-1.5.82-2.33.82Z"/>
  </g>
  <g>
    <path class="cls-1" d="M596.11,104.5h-75.2c-2.05,0-3.72-1.66-3.72-3.72s1.66-3.72,3.72-3.72h75.2c2.05,0,3.72,1.66,3.72,3.72s-1.66,3.72-3.72,3.72Z"/>
    <path class="cls-1" d="M577.73,179.9h-74.12c-2.05,0-3.72-1.66-3.72-3.72s1.66-3.72,3.72-3.72h74.12c2.05,0,3.72,1.66,3.72,3.72s-1.66,3.72-3.72,3.72Z"/>
  </g>
</svg>`;
  const GALLERY_ASPECT = 941.43 / 272.86;

  // ------------------------------------------------
  //  LOGO 2 – příklad (jiná barva, jiný scale)
  //      -> nahraď klidně jiným SVG
  // ------------------------------------------------
  const SECOND_LOGO_SVG = GALLERY_LOGO_SVG.replace(/#daff3e/gi, '#3ee6ff'); // světle modrá
  const SECOND_ASPECT   = GALLERY_ASPECT;

  // ================================================================
  //  Generátor dvouvrstvého loga (ostrý plane + glow plane)
  // ================================================================
  function buildLogoPair({
    svgString,
    aspect,
    namePrefix,
    logoScale = 0.40,       // 0..1 z šířky stěny
    logoHeightM = null,     // pevná výška (pokud chceš ignorovat aspect)
    yMultiplier = 0.90,     // posun nad “rámovou” zónu
    glowLayer,
    scene
  }) {
    const img = new Image();
    img.src = "data:image/svg+xml;utf8," + encodeURIComponent(svgString);

    img.onload = () => {
      // --- ostrá textura ---
      const SIZE = 1024;
      const dt     = new BABYLON.DynamicTexture(`${namePrefix}_DT`,      { width: SIZE, height: SIZE }, scene, true);
      const dtGlow = new BABYLON.DynamicTexture(`${namePrefix}_Glow_DT`, { width: SIZE, height: SIZE }, scene, true);

      const ctx = dt.getContext();
      const gc  = dtGlow.getContext();
      ctx.clearRect(0,0,SIZE,SIZE);
      gc.clearRect(0,0,SIZE,SIZE);

      const maxW = SIZE * 0.92;
      const w = maxW;
      const h = Math.round(maxW / aspect);
      const x = Math.round((SIZE - w)/2);
      const y = Math.round((SIZE - h)/2);

      ctx.drawImage(img, x, y, w, h);
      dt.update();

      gc.filter = `blur(${GLOW_BLUR_PX}px)`;
      gc.drawImage(img, x, y, w, h);
      dtGlow.update();

      // --- materiály ---
      const sharpMat = new BABYLON.StandardMaterial(`${namePrefix}_SharpMat`, scene);
      sharpMat.disableLighting = true;
      sharpMat.diffuseTexture  = dt;
      sharpMat.opacityTexture  = dt;
      sharpMat.emissiveColor   = new BABYLON.Color3(1,1,1);
      sharpMat.backFaceCulling = false;

      const glowMat = new BABYLON.StandardMaterial(`${namePrefix}_GlowMat`, scene);
      glowMat.disableLighting  = true;
      glowMat.emissiveTexture  = dtGlow;
      glowMat.opacityTexture   = dtGlow;
      glowMat.emissiveColor    = new BABYLON.Color3(1,1,1);
      glowMat.backFaceCulling  = false;

      // --- rozměry loga (m) ---
      const logoW = ROOM.W * logoScale;
      const logoH = logoHeightM ?? (logoW / aspect);

      // výška nad rámy – střed galerie
      const yPos = WALL_LAYOUT.centerY + FRAME_SIZE.H * yMultiplier + 0.40;

      function placeLogo(z, rotY, idx) {
        // glow plane – mírně přisazený ke stěně
        const g = BABYLON.MeshBuilder.CreatePlane(`${namePrefix}_Glow_${idx}`, { width: logoW, height: logoH, sideOrientation: BABYLON.Mesh.DOUBLESIDE }, scene);
        g.position.set(0, yPos, z - Math.sign(z) * 0.005);
        g.rotation.y = rotY;
        g.material   = glowMat;
        glowLayer.addIncludedOnlyMesh(g);

        // ostrý plane – o pár mm vpředu, aby neblikalo se stěnou
        const s = BABYLON.MeshBuilder.CreatePlane(`${namePrefix}_Sharp_${idx}`, { width: logoW, height: logoH, sideOrientation: BABYLON.Mesh.DOUBLESIDE }, scene);
        s.position.set(0, yPos, z + Math.sign(z) * 0.005);
        s.rotation.y = rotY;
        s.material   = sharpMat;
      }

      // zadní + přední stěna
      placeLogo(-ROOM.D/2 + FRONT_BACK_OFFSET, Math.PI, 0);
      placeLogo( ROOM.D/2 - FRONT_BACK_OFFSET, 0,      1);

      hint(`${namePrefix}: zobrazeno ✔ (glow aktivní)`);
    };

    img.onerror = () => {
      console.error(`${namePrefix}: SVG nešlo dekódovat.`);
      hint(`Chyba: ${namePrefix} SVG nešlo dekódovat.`);
    };
  }


  // ================================================================
  //  Babylon bootstrapping
  // ================================================================
  const canvas = document.getElementById('renderCanvas');
  const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });

  const createScene = function () {
    const scene = new BABYLON.Scene(engine);
    scene.clearColor = new BABYLON.Color4(0,0,0,1);

    // Kamera
    const camera = new BABYLON.ArcRotateCamera('cam', -Math.PI/2, Math.PI/3, 22, new BABYLON.Vector3(0, 1.6, 0), scene);
    camera.attachControl(canvas, true);

    // Světlo
    const light = new BABYLON.HemisphericLight('hemi', new BABYLON.Vector3(0,1,0), scene);
    light.intensity = 0.9;

    // Jednoduchá “místnost” (dvojité stěny kvůli jednoduchosti)
    const wallMat = new BABYLON.StandardMaterial('wall', scene);
    wallMat.diffuseColor   = new BABYLON.Color3(0.12, 0.12, 0.12);
    wallMat.specularColor  = new BABYLON.Color3(0,0,0);
    wallMat.backFaceCulling = false;

    // Podlaha
    const floor = BABYLON.MeshBuilder.CreateGround('floor', { width: ROOM.W, height: ROOM.D }, scene);
    const floorMat = new BABYLON.StandardMaterial('floorMat', scene);
    floorMat.diffuseColor = new BABYLON.Color3(0.08, 0.08, 0.08);
    floor.material = floorMat;

    // Stěny (přední a zadní)
    const backWall = BABYLON.MeshBuilder.CreatePlane('backWall', { width: ROOM.W, height: ROOM.H, sideOrientation: BABYLON.Mesh.DOUBLESIDE }, scene);
    backWall.position.set(0, ROOM.H/2, -ROOM.D/2);
    backWall.rotation.y = Math.PI;
    backWall.material = wallMat;

    const frontWall = BABYLON.MeshBuilder.CreatePlane('frontWall', { width: ROOM.W, height: ROOM.H, sideOrientation: BABYLON.Mesh.DOUBLESIDE }, scene);
    frontWall.position.set(0, ROOM.H/2,  ROOM.D/2);
    frontWall.rotation.y = 0;
    frontWall.material = wallMat;

    // GlowLayer – jen pro naše glow plane
    const glow = new BABYLON.GlowLayer('glow', scene, { mainTextureFixedSize: 1024, blurKernelSize: 64 });
    glow.intensity = 0.6;

    // Vykresli 2 loga (každé na obě stěny)
    buildLogoPair({
      svgString: GALLERY_LOGO_SVG,
      aspect: GALLERY_ASPECT,
      namePrefix: 'GalleryLogo',
      logoScale: 0.40,
      // logoHeightM: 5.8, // pokud chceš fixní výšku
      yMultiplier: 0.90,
      glowLayer: glow,
      scene
    });

    buildLogoPair({
      svgString: SECOND_LOGO_SVG,
      aspect: SECOND_ASPECT,
      namePrefix: 'SecondLogo',
      logoScale: 0.28,
      yMultiplier: 0.90,
      glowLayer: glow,
      scene
    });

    return scene;
  };

  const scene = createScene();

  engine.runRenderLoop(function(){
    scene.render();
  });

  window.addEventListener('resize', function(){
    engine.resize();
  });
  </script>
</body>
</html>
